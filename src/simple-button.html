<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html" async>

<dom-module id="simple-button">
  <template>
    <style>
      /* Sane resets */
      :host, *, *::before, *::after {
        box-sizing: border-box;
        -moz-osx-font-smoothing: grayscale;
         -webkit-font-smoothing: antialiased;
                 font-smoothing: antialiased;
      }

      /* Shim inconsistent browser hidden styles */
      *[hidden] {
        display: none !important;
      }

      :host {
        position: relative;
        cursor: pointer;

        /* Reset default button styles */
        font: inherit;
        color: inherit;
        line-height: normal;
        background: none;
        user-select: none;
        -webkit-touch-callout: none;
        border: 0;
        padding: 0;
        outline: 0;
      }

      /* Disable Firefox focus styles */
      :host::-moz-focus-inner {
        border: 0;
        margin: 0;
        padding: 0;
      }

      :host([disabled]),
      :host([busy]) {
        cursor: default;
        pointer-events: none;
      }

      .wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: -0.005em
      }

      :host([align="right"]) .wrapper {
        flex-direction: row-reverse;
      }

      .busy {
        width: 0;
        transition: width 180ms cubic-bezier(0.4, 0.0, 0.2, 1);
      }

      .busy[data-active] {
        width: 1.3em;
        transition-duration: 200ms;
      }

      .busy__spinner {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        height: 1.1em;
        width: 1.1em;
      }

      :host([align="left"]) .busy__spinner {
        left: 0.8em;
      }

      :host([align="right"]) .busy__spinner {
        right: 0.8em;
      }

      .icon {
        --iron-icon-width: var(--simple-button-icon-size, 1em);
        --iron-icon-height: var(--simple-button-icon-size, 1em);
      }

      :host([align="left"]) .icon {
        margin-right: var(--simple-button-icon-offset, 0.35em);
      }

      :host([align="right"]) .icon {
        margin-left: var(--simple-button-icon-offset, 0.35em);
      }

      .icon[data-no-content] {
        margin: 0 !important;
      }

      /**
       * Spinkit busy spinner
       * From https://github.com/tobiasahlin/SpinKit/blob/master/examples/10-fading-circle.html
       */
      .sk-fading-circle .sk-child {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
      }

      .sk-fading-circle .sk-child:before {
        content: '';
        display: block;
        margin: 0 auto;
        width: 15%;
        height: 15%;
        background-color: currentColor;
        border-radius: 100%;
        animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;
      }

      .sk-fading-circle .sk-circle2 {
        transform: rotate(30deg);
      }

      .sk-fading-circle .sk-circle3 {
        transform: rotate(60deg);
      }

      .sk-fading-circle .sk-circle4 {
        transform: rotate(90deg);
      }

      .sk-fading-circle .sk-circle5 {
        transform: rotate(120deg);
      }

      .sk-fading-circle .sk-circle6 {
        transform: rotate(150deg);
      }

      .sk-fading-circle .sk-circle7 {
        transform: rotate(180deg);
      }

      .sk-fading-circle .sk-circle8 {
        transform: rotate(210deg);
      }

      .sk-fading-circle .sk-circle9 {
        transform: rotate(240deg);
      }

      .sk-fading-circle .sk-circle10 {
        transform: rotate(270deg);
      }

      .sk-fading-circle .sk-circle11 {
        transform: rotate(300deg);
      }

      .sk-fading-circle .sk-circle12 {
        transform: rotate(330deg);
      }

      .sk-fading-circle .sk-circle2:before {
        animation-delay: -1.1s;
      }

      .sk-fading-circle .sk-circle3:before {
        animation-delay: -1s;
      }

      .sk-fading-circle .sk-circle4:before {
        animation-delay: -0.9s;
      }

      .sk-fading-circle .sk-circle5:before {
        animation-delay: -0.8s;
      }

      .sk-fading-circle .sk-circle6:before {
        animation-delay: -0.7s;
      }

      .sk-fading-circle .sk-circle7:before {
        animation-delay: -0.6s;
      }

      .sk-fading-circle .sk-circle8:before {
        animation-delay: -0.5s;
      }

      .sk-fading-circle .sk-circle9:before {
        animation-delay: -0.4s;
      }

      .sk-fading-circle .sk-circle10:before {
        animation-delay: -0.3s;
      }

      .sk-fading-circle .sk-circle11:before {
        animation-delay: -0.2s;
      }

      .sk-fading-circle .sk-circle12:before {
        animation-delay: -0.1s;
      }

     @keyframes sk-circleFadeDelay {
        0%, 39%, 100% { opacity: 0; }
        40% { opacity: 1; }
      }
    </style>

    <div class="wrapper">

      <div class="busy" id="busy" data-active$="[[busy]]">
        <template is="dom-if" if="[[busy]]">
          <div class="busy__spinner sk-fading-circle">
            <div class="sk-child sk-circle1"></div>
            <div class="sk-child sk-circle2"></div>
            <div class="sk-child sk-circle3"></div>
            <div class="sk-child sk-circle4"></div>
            <div class="sk-child sk-circle5"></div>
            <div class="sk-child sk-circle6"></div>
            <div class="sk-child sk-circle7"></div>
            <div class="sk-child sk-circle8"></div>
            <div class="sk-child sk-circle9"></div>
            <div class="sk-child sk-circle10"></div>
            <div class="sk-child sk-circle11"></div>
            <div class="sk-child sk-circle12"></div>
          </div>
        </template>
      </div>

      <iron-icon
        class="icon"
        icon=[[icon]]
        data-no-content$=[[!_hasContent]]
        hidden$=[[!icon]]>
      </iron-icon>

      <content></content>

    </div>
  </template>

  <script>
    class SimpleButton {
      beforeRegister() {
        this.is = 'simple-button';

        this.extends = 'button';

        this.properties = {

          align: {
            type: String,
            reflectToAttribute: true,
            value: 'left'
          },

          icon: {
            type: String,
            value: ''
          },

          busy: {
            type: Boolean,
            observer: '_busyChanged',
            notify: true,
            reflectToAttribute: true
          },

          busySpinner: {
            type: String,
            value: 'fading-circle'
          },

          _hasContent: {
            type: Boolean,
            value: false
          }

        };
      };

      _observeContent() {
        let content = Polymer.dom(this);

        content.observeNodes(() => {
          this._hasContent = !!content.innerHTML.trim();
        });
      }

      _busyChanged(busy) {
        if (busy) {
          this.customStyle['--spinkit-element-color'] = getComputedStyle(this).color;
          this.updateStyles();
        }
      }

      attached() {
        this._observeContent();
      }

    };
    Polymer(SimpleButton)
  </script>
</dom-module>
